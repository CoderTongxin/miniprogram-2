# I Agree - 情侣电子流审批小程序

## 项目介绍

这是一个用于情侣（或亲密关系）间发起、审批、管理日常消费或事项申请的微信小程序。采用 TDesign 微信小程序组件库构建，提供美观流畅的用户体验。

## 技术栈

- 微信小程序原生开发（WXML, WXSS, JS）
- TDesign 微信小程序组件库 v1.12.1
- 微信云开发（可选）

## 页面结构

### 1. 首页 (pages/home)
- **功能**：展示电子流列表，支持三个Tab切换
- **Tab标签**：
  - 我的待办：待审批的申请（当前用户为审批人）
  - 我的申请：当前用户发起的所有申请
  - 已完成：已完成状态的申请
- **特性**：
  - 用户信息展示（头像、昵称、本月支出统计）
  - 类型筛选（全部、拨款、出行、其他）
  - 浮动新建按钮
  - 点击支出金额跳转统计页面

### 2. 创建/编辑页 (pages/editFlow)
- **功能**：新建或编辑电子流申请
- **表单字段**：
  - 申请内容（必填，多行文本）
  - 申请金额（必填，数字输入，选择"其他"类型时为选填）
  - 申请类型（必填，三选一：拨款、出行、其他）
  - 审批人（默认显示）
- **特性**：
  - 表单验证
  - 取消确认提示
  - 支持编辑已驳回的申请

### 3. 电子流详情页 (pages/flow-detail)
- **功能**：查看电子流详情，进行审批操作
- **展示内容**：
  - 申请人信息
  - 申请金额、类型、内容
  - 审批人信息
  - 审批流程时间线
  - 驳回原因（如有）
- **操作**：
  - 通过申请
  - 驳回申请（需填写驳回原因）
  - 重新编辑（已驳回状态）

### 4. 统计分析页 (pages/statistics)
- **功能**：数据统计与分析
- **统计维度**：
  - 年度/月度切换
  - 总支出、申请总数、通过率
  - 分类支出统计（柱状图）
  - 支出趋势（月度对比）
  - 统计摘要（日均支出、最大单笔、最常申请、驳回次数）

## 数据模型

```javascript
// 电子流 (Flow) 数据结构
{
  id: String,                    // 唯一标识
  applicantId: String,           // 申请人ID
  applicantName: String,         // 申请人昵称
  applicantAvatar: String,       // 申请人头像
  approverId: String,            // 审批人ID
  approverName: String,          // 审批人昵称
  approverAvatar: String,        // 审批人头像
  content: String,               // 申请内容
  amount: String,                // 金额
  type: String,                  // 类型: funds/travel/other
  typeText: String,              // 类型文本
  status: String,                // 状态: pending/completed/rejected
  statusText: String,            // 状态文本
  createTime: String,            // 创建时间
  approveTime: String,           // 审批时间
  rejectReason: String,          // 驳回原因
  approveComment: String         // 审批备注
}
```

## 状态流转

```
待审批 (pending) ──→ 已完成 (completed)  [审批人通过]
     ↓
已驳回 (rejected) ──→ 待审批 (pending)   [申请人重新编辑]
```

## 快速开始

### 1. 安装依赖

```bash
cd miniprogram
npm install
```

### 2. 构建 npm

在微信开发者工具中：
1. 打开项目
2. 点击菜单栏：工具 -> 构建 npm
3. 等待构建完成

### 3. 运行项目

在微信开发者工具中打开项目即可预览

## 项目配置

### app.json 配置说明

- **pages**: 页面路由配置
- **window**: 窗口表现配置
- **usingComponents**: 全局引入 TDesign 组件

### 云开发配置

如需使用云开发功能，请在 `app.js` 中配置环境ID：

```javascript
env: "your-env-id"
```

## 目录结构

```
miniprogram/
├── pages/                  # 页面目录
│   ├── home/              # 首页
│   ├── editFlow/          # 创建/编辑页
│   ├── flow-detail/       # 详情页
│   └── statistics/        # 统计页
├── components/            # 组件目录
├── images/                # 图片资源
├── app.js                 # 小程序入口文件
├── app.json              # 全局配置
├── app.wxss              # 全局样式
└── package.json          # 依赖配置
```

## 样式规范

### 颜色规范（TDesign 风格）

- **主题色**: #0052D9 (蓝色)
- **成功色**: #029B6C (绿色)
- **警告色**: #E37318 (橙色)
- **错误色**: #D54941 (红色)
- **辅助色**: #666666 (灰色)

### 字体大小

- 大标题: 72rpx
- 标题: 36rpx
- 正文: 28rpx
- 辅助文字: 24rpx

### 圆角规范

- 卡片: 16rpx
- 按钮: 12rpx
- 标签: 8rpx
- 头像: 50%

## 开发建议

### 1. 数据管理

目前使用模拟数据，实际开发中建议：
- 使用微信云开发数据库存储电子流数据
- 在 app.js 中管理全局用户状态
- 使用 Storage 缓存常用数据

### 2. 用户系统

- 使用 `wx.getUserProfile()` 获取用户信息
- 实现伴侣绑定功能
- 添加用户登录状态判断

### 3. 通知功能

- 使用订阅消息通知审批人
- 审批结果通知申请人
- 月度统计摘要推送

### 4. 性能优化

- 列表页使用分页加载
- 图片使用 CDN 加速
- 合理使用缓存策略

## 后续功能扩展

1. 【用户系统】
   - 微信授权登录
   - 伴侣绑定/解绑
   - 用户设置页

2. 【电子流功能】
   - 图片凭证上传
   - 电子流搜索
   - 导出功能

3. 【统计功能】
   - 更多图表类型
   - 自定义时间范围
   - 数据导出

4. 【通知功能】
   - 订阅消息
   - 消息中心
   - 站内通知

5. 【其他功能】
   - 分享功能
   - 主题切换
   - 多语言支持

## 注意事项

1. TDesign 组件需要正确构建 npm 才能使用
2. 部分功能依赖微信云开发，需要开通云服务
3. 图片资源建议使用云存储或 CDN
4. 测试时注意权限配置（获取用户信息等）

## 联系方式

如有问题或建议，欢迎提出 Issue 或 PR。

## 许可证

MIT License
