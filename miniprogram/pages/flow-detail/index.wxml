<!-- ç”µå­æµè¯¦æƒ… -->
<view class="page">
  <!-- æˆåŠŸ/é©³å›æ¨ªå¹… -->
  <view wx:if="{{flowData.status === 'completed'}}" class="status-banner success">
    <text class="banner-icon">âœ“</text>
    <text class="banner-text">ç”³è¯·å·²é€šè¿‡</text>
    <text class="banner-time">å®¡æ‰¹å®Œæˆæ—¶é—´ï¼š{{flowData.approveTime}}</text>
  </view>

  <!-- è¯¦æƒ…å¡ç‰‡ -->
  <view class="detail-card">
    <!-- ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-section">
      <image class="avatar" src="{{flowData.applicantAvatar}}" mode="aspectFill"></image>
      <view class="user-info">
        <text class="user-name">{{flowData.applicantName}}</text>
        <text class="user-time">{{flowData.createTime}}</text>
      </view>
      <view class="status-badge">
        <!-- çŠ¶æ€æ ‡ç­¾ï¼šæµ…è‰²é€æ˜èƒŒæ™¯ -->
        <t-tag 
          theme="{{flowData.status === 'pending' ? 'warning' : flowData.status === 'completed' ? 'success' : 'danger'}}" 
          variant="light"
        >
          {{flowData.statusText}}
        </t-tag>
      </view>
    </view>

    <!-- é‡‘é¢ -->
    <view class="info-row">
      <text class="info-label">ç”³è¯·é‡‘é¢</text>
      <text class="info-amount {{flowData.status === 'completed' ? 'completed' : ''}}">
        Â¥{{flowData.amount}}
      </text>
    </view>

    <!-- ç±»å‹ -->
    <view class="info-row">
      <text class="info-label">ç”³è¯·ç±»å‹</text>
      <!-- ç±»å‹æ ‡ç­¾ï¼šçº¯è‰²èƒŒæ™¯ -->
      <t-tag 
        theme="{{flowData.type === 'other' ? 'default' : 'primary'}}"
        class="type-tag type-tag-{{flowData.type}}"
      >
        {{flowData.typeText}}
      </t-tag>
    </view>

    <!-- ç”³è¯·å†…å®¹ -->
    <view class="info-row">
      <text class="info-label">ç”³è¯·å†…å®¹</text>
      <text class="info-value">{{flowData.content}}</text>
    </view>

    <!-- å®¡æ‰¹äºº -->
    <view class="info-row last">
      <text class="info-label">å®¡æ‰¹äºº</text>
      <view class="approver-info">
        <image class="approver-avatar" src="{{flowData.approverAvatar}}" mode="aspectFill"></image>
        <text class="approver-name">{{flowData.approverName}}</text>
      </view>
    </view>

    <!-- é©³å›åŸå›  -->
    <view wx:if="{{flowData.status === 'rejected'}}" class="reject-reason">
      <view class="reject-title">ğŸ’¬ é©³å›åŸå› </view>
      <text class="reject-text">{{flowData.rejectReason}}</text>
    </view>
  </view>

  <!-- å®¡æ‰¹æµç¨‹ -->
  <view class="detail-card">
    <text class="section-title">å®¡æ‰¹æµç¨‹</text>
    <view class="timeline">
      <view class="timeline-item">
        <view class="timeline-dot"></view>
        <view class="timeline-content">
          <text class="timeline-title">{{flowData.applicantName}} å‘èµ·ç”³è¯·</text>
          <text class="timeline-time">{{flowData.createTime}}</text>
        </view>
      </view>
      
      <view wx:if="{{flowData.status === 'pending'}}" class="timeline-item">
        <view class="timeline-dot pending"></view>
        <view class="timeline-content">
          <text class="timeline-title gray">ç­‰å¾… {{flowData.approverName}} å®¡æ‰¹</text>
          <text class="timeline-time">å¾…å¤„ç†</text>
        </view>
      </view>

      <view wx:if="{{flowData.status === 'completed'}}" class="timeline-item">
        <view class="timeline-dot completed"></view>
        <view class="timeline-content">
          <text class="timeline-title success">{{flowData.approverName}} é€šè¿‡äº†ç”³è¯·</text>
          <text class="timeline-time">{{flowData.approveTime}}</text>
          <text wx:if="{{flowData.approveComment}}" class="timeline-comment">
            {{flowData.approveComment}}
          </text>
        </view>
      </view>

      <view wx:if="{{flowData.status === 'rejected'}}" class="timeline-item">
        <view class="timeline-dot rejected"></view>
        <view class="timeline-content">
          <text class="timeline-title rejected">{{flowData.approverName}} é©³å›äº†ç”³è¯·</text>
          <text class="timeline-time">{{flowData.approveTime}}</text>
          <text class="timeline-comment">{{flowData.rejectReason}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å®¡æ‰¹æ“ä½œæŒ‰é’®ï¼ˆä»…å¾…å®¡æ‰¹çŠ¶æ€æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{flowData.status === 'pending' && canApprove}}" class="action-buttons">
    <t-button theme="default" size="large" bind:tap="onReject" class="btn-reject">
      é©³å›
    </t-button>
    <t-button theme="primary" size="large" bind:tap="onApprove" class="btn-approve">
      é€šè¿‡
    </t-button>
  </view>

  <!-- é‡æ–°ç¼–è¾‘æŒ‰é’®ï¼ˆå·²é©³å›çŠ¶æ€æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{flowData.status === 'rejected' && canEdit}}" class="action-buttons">
    <t-button theme="primary" size="large" bind:tap="onEdit" block>
      é‡æ–°ç¼–è¾‘å¹¶æäº¤
    </t-button>
  </view>

  <!-- é©³å›å¼¹çª— -->
  <t-dialog
    visible="{{showRejectDialog}}"
    title="é©³å›åŸå› "
    confirm-btn="ç¡®è®¤é©³å›"
    cancel-btn="å–æ¶ˆ"
    bind:confirm="onConfirmReject"
    bind:cancel="onCancelReject"
  >
    <t-textarea
      slot="content"
      value="{{rejectReason}}"
      placeholder="è¯·è¾“å…¥é©³å›åŸå› ï¼ˆå¿…å¡«ï¼‰"
      maxlength="200"
      indicator
      bind:change="onRejectReasonChange"
      auto-height
    />
  </t-dialog>

  <!-- Toast æç¤º -->
  <t-toast id="t-toast" />
</view>
