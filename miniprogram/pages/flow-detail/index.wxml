<!-- ç”µå­æµè¯¦æƒ… - è®¾è®¡ç³»ç»Ÿé‡æ„ç‰ˆ -->
<view class="ds-page ds-page--with-decor ds-safe-top ds-safe-bottom">
  
  <!-- æ¸¸å®¢ä½“éªŒæç¤º -->
  <view wx:if="{{isDemo}}" class="guest-banner" bindtap="onGuestBannerTap">
    <text class="guest-banner__icon">ğŸ‘€</text>
    <text class="guest-banner__text">æ¸¸å®¢ä½“éªŒæ¨¡å¼ Â· ç™»å½•åå¯è¿›è¡Œå®¡æ‰¹æ“ä½œ</text>
    <text class="guest-banner__action">å»ç™»å½• â€º</text>
  </view>

  <!-- æˆåŠŸ/é©³å›æ¨ªå¹… -->
  <view wx:if="{{flowData.status === 'completed'}}" class="status-banner success">
    <text class="banner-icon">âœ“</text>
    <text class="banner-text">ç”³è¯·å·²é€šè¿‡</text>
    <text class="banner-time">å®¡æ‰¹å®Œæˆæ—¶é—´ï¼š{{flowData.approveTime}}</text>
  </view>

  <!-- è¯¦æƒ…å¡ç‰‡ -->
  <view class="ds-main">
    <view class="ds-card ds-card--strong">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="user-section">
        <image class="detail-avatar" src="{{flowData.applicantAvatar || '/images/default_logo.png'}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="ds-text-subtitle">{{flowData.applicantName}}</text>
          <text class="ds-text-desc">{{flowData.createTime}}</text>
        </view>
        <view class="ds-tag ds-tag--{{flowData.status === 'pending' ? 'yellow' : flowData.status === 'completed' ? 'success' : 'danger'}}">
          {{flowData.statusText}}
        </view>
      </view>

      <view class="ds-divider"></view>

      <!-- é‡‘é¢ -->
      <view class="info-row">
        <text class="ds-text-desc">ç”³è¯·é‡‘é¢</text>
        <view class="info-amount {{flowData.status === 'completed' ? 'success' : ''}}">
          Â¥{{flowData.amount}}
        </view>
      </view>

      <!-- ç±»å‹ -->
      <view class="info-row">
        <text class="ds-text-desc">ç”³è¯·ç±»å‹</text>
        <view class="ds-tag ds-tag--{{flowData.type}} type-tag">{{flowData.typeText}}</view>
      </view>

      <!-- ç”³è¯·å†…å®¹ -->
      <view class="info-row">
        <text class="ds-text-desc">ç”³è¯·å†…å®¹</text>
        <text class="ds-text-body content-text">{{flowData.content}}</text>
      </view>

      <!-- å®¡æ‰¹äºº -->
      <view class="info-row">
        <text class="ds-text-desc">å®¡æ‰¹äºº</text>
        <view class="ds-row approver-row">
          <image class="approver-avatar" src="{{flowData.approverAvatar || '/images/default_logo.png'}}" mode="aspectFill"></image>
          <text class="ds-text-body">{{flowData.approverName}}</text>
        </view>
      </view>

      <!-- é©³å›åŸå›  -->
      <view wx:if="{{flowData.status === 'rejected'}}" class="reject-reason">
        <view class="reject-title">ğŸ’¬ é©³å›åŸå› </view>
        <text class="ds-text-body">{{flowData.rejectReason}}</text>
      </view>
    </view>

    <!-- å®¡æ‰¹æµç¨‹ -->
    <view class="ds-card">
      <view class="ds-card__titleRow">
        <view class="ds-card__icon"></view>
        <text class="ds-card__title">å®¡æ‰¹æµç¨‹</text>
      </view>
      
      <view class="timeline">
        <view class="timeline-item">
          <view class="timeline-dot"></view>
          <view class="timeline-content">
            <text class="ds-text-body timeline-title">{{flowData.applicantName}} å‘èµ·ç”³è¯·</text>
            <text class="ds-text-tip">{{flowData.createTime}}</text>
          </view>
        </view>
        
        <view wx:if="{{flowData.status === 'pending'}}" class="timeline-item">
          <view class="timeline-dot pending"></view>
          <view class="timeline-content">
            <text class="ds-text-body timeline-title gray">ç­‰å¾… {{flowData.approverName}} å®¡æ‰¹</text>
            <text class="ds-text-tip">å¾…å¤„ç†</text>
          </view>
        </view>

        <view wx:if="{{flowData.status === 'completed'}}" class="timeline-item">
          <view class="timeline-dot completed"></view>
          <view class="timeline-content">
            <text class="ds-text-body timeline-title success">{{flowData.approverName}} é€šè¿‡äº†ç”³è¯·</text>
            <text class="ds-text-tip">{{flowData.approveTime}}</text>
            <text wx:if="{{flowData.approveComment}}" class="timeline-comment">
              {{flowData.approveComment}}
            </text>
          </view>
        </view>

        <view wx:if="{{flowData.status === 'rejected'}}" class="timeline-item">
          <view class="timeline-dot rejected"></view>
          <view class="timeline-content">
            <text class="ds-text-body timeline-title rejected">{{flowData.approverName}} é©³å›äº†ç”³è¯·</text>
            <text class="ds-text-tip">{{flowData.approveTime}}</text>
            <text class="ds-text-desc timeline-comment">{{flowData.rejectReason}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å®¡æ‰¹æ“ä½œæŒ‰é’®ï¼ˆä»…å¾…å®¡æ‰¹çŠ¶æ€æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{flowData.status === 'pending' && canApprove}}" class="action-buttons">
    <button class="ds-btn-secondary btn-reject" bind:tap="onReject">
      <text class="ds-btn-text">é©³å›</text>
    </button>
    <button class="ds-btn-primary btn-approve" bind:tap="onApprove">
      <text class="ds-btn-text">é€šè¿‡</text>
    </button>
  </view>

  <!-- é‡æ–°ç¼–è¾‘æŒ‰é’®ï¼ˆå·²é©³å›çŠ¶æ€æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{flowData.status === 'rejected' && canEdit}}" class="action-buttons">
    <button class="ds-btn-primary" style="width: 100%;" bind:tap="onEdit">
      <text class="ds-btn-text">é‡æ–°ç¼–è¾‘å¹¶æäº¤</text>
    </button>
  </view>

  <!-- é©³å›å¼¹çª— -->
  <t-dialog
    visible="{{showRejectDialog}}"
    title="é©³å›åŸå› "
    confirm-btn="ç¡®è®¤é©³å›"
    cancel-btn="å–æ¶ˆ"
    bind:confirm="onConfirmReject"
    bind:cancel="onCancelReject"
  >
    <t-textarea
      slot="content"
      value="{{rejectReason}}"
      placeholder="è¯·è¾“å…¥é©³å›åŸå› ï¼ˆå¿…å¡«ï¼‰"
      maxlength="200"
      indicator
      bind:change="onRejectReasonChange"
      auto-height
    />
  </t-dialog>

  <!-- Toast æç¤º -->
  <t-toast id="t-toast" />
</view>
