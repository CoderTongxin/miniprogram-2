<!-- æ•°æ®ç»Ÿè®¡ - è®¾è®¡ç³»ç»Ÿé‡æ„ç‰ˆ -->
<view class="ds-page ds-page--with-decor ds-safe-top ds-safe-bottom">
  
  <!-- å¤´éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="ds-main">
    <view class="ds-card ds-card--strong header-stats">
      <text class="ds-text-desc">{{currentPeriodText}} æ€»æ”¯å‡º</text>
      <text class="header-amount">Â¥{{totalAmount}}</text>
      <view class="stats-grid">
        <view class="stat-item">
          <view class="stat-value-wrapper">
            <text class="stat-value">{{totalCount}}</text>
          </view>
          <text class="ds-text-tip">ç”³è¯·æ€»æ•°</text>
        </view>
        <view class="stat-item">
          <view class="stat-value-wrapper">
            <text class="stat-value">{{approvedCount}}</text>
          </view>
          <text class="ds-text-tip">å·²é€šè¿‡</text>
        </view>
        <view class="stat-item">
          <view class="stat-value-wrapper">
            <text class="stat-value">{{approveRate}}%</text>
          </view>
          <text class="ds-text-tip">é€šè¿‡ç‡</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="ds-main">
    <view class="ds-card">
      <view class="ds-formItem">
        <text class="ds-formItem__label">é€‰æ‹©æ—¶é—´èŒƒå›´</text>
        
        <!-- å¹´åº¦/æœˆåº¦åˆ‡æ¢ -->
        <view class="filter-tabs">
          <view 
            class="filter-tab {{periodType === 'year' ? 'active' : ''}}" 
            bindtap="onPeriodTypeChange" 
            data-type="year"
          >
            å¹´åº¦
          </view>
          <view 
            class="filter-tab {{periodType === 'month' ? 'active' : ''}}" 
            bindtap="onPeriodTypeChange" 
            data-type="month"
          >
            æœˆåº¦
          </view>
        </view>

        <!-- å¹´åº¦é€‰æ‹© -->
        <view wx:if="{{periodType === 'year'}}" class="period-grid">
          <view 
            wx:for="{{yearList}}" 
            wx:key="*this"
            class="period-item {{selectedYear === item ? 'active' : ''}}"
            bindtap="onYearChange"
            data-year="{{item}}"
          >
            {{item}}å¹´
          </view>
        </view>

        <!-- æœˆåº¦é€‰æ‹© -->
        <view wx:if="{{periodType === 'month'}}" class="period-grid">
          <view 
            wx:for="{{monthList}}" 
            wx:key="*this"
            class="period-item {{selectedMonth === item ? 'active' : ''}}"
            bindtap="onMonthChange"
            data-month="{{item}}"
          >
            {{item}}æœˆ
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç»Ÿè®¡ -->
  <view class="ds-main">
    <view class="ds-card">
      <view class="ds-card__titleRow">
        <view class="ds-card__icon"></view>
        <text class="ds-card__title">åˆ†ç±»æ”¯å‡ºç»Ÿè®¡</text>
      </view>
      <text class="ds-text-tip">{{currentPeriodText}}</text>
      
      <view class="type-stats">
        <view class="type-row" wx:for="{{typeStats}}" wx:key="type">
          <text class="ds-text-body type-label">{{item.name}}</text>
          <view class="type-bar-wrapper">
            <view class="type-bar">
              <view 
                class="type-bar-fill" 
                style="width: {{item.percentage}}%;"
              ></view>
            </view>
          </view>
          <text class="ds-text-subtitle type-amount">Â¥{{item.amount}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ”¯å‡ºè¶‹åŠ¿ -->
  <view class="ds-main">
    <view class="ds-card">
      <view class="ds-card__titleRow">
        <view class="ds-card__icon"></view>
        <text class="ds-card__title">æ”¯å‡ºè¶‹åŠ¿</text>
      </view>
      
      <view class="trend-list">
        <view class="trend-item" wx:for="{{trendData}}" wx:key="period">
          <text class="ds-text-body">{{item.period}}</text>
          <view class="trend-right">
            <text class="ds-text-subtitle">Â¥{{item.amount}}</text>
            <view class="trend-tag {{item.change >= 0 ? 'up' : 'down'}}">
              <text class="ds-text-tip">{{item.change >= 0 ? '+' : ''}}{{item.change}}%</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ‘˜è¦ -->
  <view class="ds-main">
    <view class="ds-card">
      <view class="ds-card__titleRow">
        <view class="ds-card__icon"></view>
        <text class="ds-card__title">{{periodType === 'year' ? 'å¹´åº¦' : 'æœ¬æœˆ'}}ç»Ÿè®¡æ‘˜è¦</text>
      </view>
      
      <view class="summary-grid">
        <view class="summary-item">
          <view class="summary-icon">ğŸ“Š</view>
          <text class="ds-text-tip">æ—¥å‡æ”¯å‡º</text>
          <text class="summary-value primary">Â¥{{avgDaily}}</text>
        </view>
        <view class="summary-item">
          <view class="summary-icon">ğŸ’°</view>
          <text class="ds-text-tip">æœ€å¤§å•ç¬”</text>
          <text class="summary-value success">Â¥{{maxSingle}}</text>
        </view>
        <view class="summary-item">
          <view class="summary-icon">â­</view>
          <text class="ds-text-tip">æœ€å¸¸ç”³è¯·</text>
          <text class="summary-value">{{mostFrequent}}</text>
        </view>
        <view class="summary-item">
          <view class="summary-icon">âŒ</view>
          <text class="ds-text-tip">é©³å›æ¬¡æ•°</text>
          <text class="summary-value danger">{{rejectedCount}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Toast æç¤º -->
  <t-toast id="t-toast" />
</view>
